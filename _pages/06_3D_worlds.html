

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6. 3D Worlds &#8212; Computer Graphics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"model": ["M\\!odel"], "view": ["V\\!iew"], "mvp": ["MV\\!P"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_pages/06_3D_worlds';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Moving the camera" href="07_Moving_the_camera.html" />
    <link rel="prev" title="5. Transformations" href="05_transformations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Computer Graphics
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_intro_to_cpp.html">1. Introduction to C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_basic_shapes_in_OpenGL.html">2. Basic Shapes in OpenGL</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_textures.html">3. Textures</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_vectors_and_matrices.html">4. Vectors and Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_transformations.html">5. Transformations</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">6. 3D Worlds</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_Moving_the_camera.html">7. Moving the camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_Lighting.html">8. Lighting</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_Normal_mapping.html">9. Normal Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_Quaternions.html">10. Quaternions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="A_Complex_numbers_and_quaternions.html">A. Complex Numbers and Quaternions</a></li>
<li class="toctree-l1"><a class="reference internal" href="B_Code.html">B. Code and Assets</a></li>
<li class="toctree-l1"><a class="reference internal" href="C_Glossary.html">C Glossary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jonshiach/graphics-labs" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jonshiach/graphics-labs/issues/new?title=Issue%20on%20page%20%2F_pages/06_3D_worlds.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/_pages/06_3D_worlds.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>3D Worlds</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#d-models">6.1. 3D models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#co-ordinate-systems">6.2. Co-ordinate systems</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-view-and-projection-matrices">6.3. Model, view and projection matrices</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model-matrix">6.3.1. The Model matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-view-matrix">6.3.2. The View matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-projection-matrix">6.3.3. The Projection matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-mvp-matrix">6.3.4. The MVP matrix</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-depth-test">6.4. The depth test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#perspective-projection">6.5. Perspective projection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-the-fov-angle">6.5.1. Changing the fov angle</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-camera-class">6.6. A camera class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-objects">6.7. Multiple objects</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">6.8. Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="d-worlds">
<span id="d-worlds-section"></span><h1><span class="section-number">6. </span>3D Worlds<a class="headerlink" href="#d-worlds" title="Permalink to this heading">#</a></h1>
<p>In the <a class="reference internal" href="05_transformations.html#transformations-section"><span class="std std-ref">previous lab</span></a> we looked at the transformations can can be applied to the vertex co-ordinates <span class="math notranslate nohighlight">\((x, y, z, 1)\)</span> but all of our examples were using transformations in 2D. In this lab we will take the step into the third spatial dimension and look at 3D worlds.</p>
<section id="d-models">
<h2><span class="section-number">6.1. </span>3D models<a class="headerlink" href="#d-models" title="Permalink to this heading">#</a></h2>
<p>To demonstrate building a simple 3D world we are going to need a 3D object. One of the simplest 3D objects is a <strong>unit cube</strong> which is a cube centred at (0,0,0) and has side lengths of 2 parallel to the co-ordinate axes (<a class="reference internal" href="#unit-cube-figure"><span class="std std-numref">Fig. 6.1</span></a>) so the co-ordinates of the 8 corners of the cube are combinations of <span class="math notranslate nohighlight">\(-1\)</span> and <span class="math notranslate nohighlight">\(1\)</span>. Since we use triangles as our base shape a cube consists of 12 triangles (6 sides each made out of 2 triangles).</p>
<figure class="align-default" id="unit-cube-figure">
<a class="reference internal image-reference" href="../_images/06_Unit_cube.svg"><img alt="../_images/06_Unit_cube.svg" src="../_images/06_Unit_cube.svg" width="500" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.1 </span><span class="caption-text">A unit cube centred at <span class="math notranslate nohighlight">\((0,0,0)\)</span> with side lengths of 2.</span><a class="headerlink" href="#unit-cube-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Open the <strong>Lab06_3D_Worlds.cpp</strong> file in the <strong>Lab06_3D_Worlds</strong> project and you will see that the <code class="docutils literal notranslate"><span class="pre">vertices</span></code>, <code class="docutils literal notranslate"><span class="pre">uv</span></code> and <code class="docutils literal notranslate"><span class="pre">indices</span></code> arrays have been defined for our unit cube.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define cube object</span>
<span class="c1">// Define vertices</span>
<span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">vertices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// front</span>
<span class="w">    </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">    </span><span class="c1">//              + ------ +</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">    </span><span class="c1">//             /|       /|</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">    </span><span class="c1">//   y        / |      / |</span>
<span class="w">    </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">    </span><span class="c1">//   |       + ------ +  |</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">    </span><span class="c1">//   + - x   |  + ----|- +</span>
<span class="w">    </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">    </span><span class="c1">//  /        | /      | /</span>
<span class="w">    </span><span class="c1">// right                // z         |/       |/</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">    </span><span class="c1">//           + ------ +</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span>
<span class="w">     </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// etc.</span>
<span class="p">};</span>

<span class="c1">// Define texture coordinates</span>
<span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">uv</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// front</span>
<span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">     </span><span class="c1">// vertex co-ordinates are the same for each side</span>
<span class="w">    </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">     </span><span class="c1">// of the cube so repeat every six vertices</span>
<span class="w">    </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span>
<span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<span class="w">    </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span>
<span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// right</span>
<span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<span class="w">    </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<span class="w">    </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span>
<span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<span class="w">    </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span>
<span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// etc.</span>
<span class="p">};</span>

<span class="c1">// Define indices</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">indices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w">   </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="mi">3</span><span class="p">,</span><span class="w">  </span><span class="mi">4</span><span class="p">,</span><span class="w">  </span><span class="mi">5</span><span class="p">,</span><span class="w">     </span><span class="c1">// front</span>
<span class="w">    </span><span class="mi">6</span><span class="p">,</span><span class="w">   </span><span class="mi">7</span><span class="p">,</span><span class="w">  </span><span class="mi">8</span><span class="p">,</span><span class="w">  </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w">     </span><span class="c1">// right</span>
<span class="w">    </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w">     </span><span class="c1">// back</span>
<span class="w">    </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w">     </span><span class="c1">// left</span>
<span class="w">    </span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w">     </span><span class="c1">// bottom</span>
<span class="w">    </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="w">      </span><span class="c1">// top</span>
<span class="p">};</span>
</pre></div>
</div>
<p>If you compile and run this program you will see that the crate texture fills the window.</p>
<figure class="align-default" id="cube-figure">
<a class="reference internal image-reference" href="../_images/06_3D_worlds.png"><img alt="../_images/06_3D_worlds.png" src="../_images/06_3D_worlds.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.2 </span><span class="caption-text">A unit cube.</span><a class="headerlink" href="#cube-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="co-ordinate-systems">
<h2><span class="section-number">6.2. </span>Co-ordinate systems<a class="headerlink" href="#co-ordinate-systems" title="Permalink to this heading">#</a></h2>
<p>OpenGL uses a co-ordinate system with the <span class="math notranslate nohighlight">\(x\)</span> axis pointing horizontally to the right, the <span class="math notranslate nohighlight">\(y\)</span> axis pointing vertically upwards and the <span class="math notranslate nohighlight">\(z\)</span> axis pointing horizontally towards the viewer. To simplify things when it comes to displaying the 3D world, the axes are limited to a range from <span class="math notranslate nohighlight">\(-1\)</span> to <span class="math notranslate nohighlight">\(1\)</span> so any object outside of this range will not be shown on the display. These are known as <strong>Normalised Device Co-ordinates (NDC)</strong>.</p>
<figure class="align-default" id="ndc-figure">
<a class="reference internal image-reference" href="../_images/06_NDC.svg"><img alt="../_images/06_NDC.svg" src="../_images/06_NDC.svg" width="600" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.3 </span><span class="caption-text">Normalised Device Co-ordinates (NDC)</span><a class="headerlink" href="#ndc-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The steps used in the creation of a 3D world and eventually displaying it on screen requires that we transform through several intermediate co-ordinate systems:</p>
<ul class="simple">
<li><p><strong>Model space</strong> – each individual 3D object that will appear in the 3D world is defined in its own space usually with the volume centre of the object at <span class="math notranslate nohighlight">\((0,0,0)\)</span> to make the transformations easier</p></li>
<li><p><strong>World space</strong> – the 3D world is constructed by transforming the individual 3D objects using translation, rotation and scaling transformations</p></li>
<li><p><strong>View space</strong> – the world space is transformed so that it is viewed from <span class="math notranslate nohighlight">\((0,0,0)\)</span> looking down the <span class="math notranslate nohighlight">\(z\)</span>-axis</p></li>
<li><p><strong>Screen space</strong> – the view space is transformed so that the co-ordinates are expressed using normalised device co-ordinates</p></li>
</ul>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../_images/06_mvp.svg"><img alt="../_images/06_mvp.svg" src="../_images/06_mvp.svg" width="500" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.4 </span><span class="caption-text">Transformations between the model, world, view and screen spaces.</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="model-view-and-projection-matrices">
<h2><span class="section-number">6.3. </span>Model, view and projection matrices<a class="headerlink" href="#model-view-and-projection-matrices" title="Permalink to this heading">#</a></h2>
<p>We saw in <a class="reference internal" href="05_transformations.html#transformations-section"><span class="std std-ref">5. Transformations</span></a> that we apply a transformation by multiplying the object co-ordinates by a transformation matrix. Since we are transforming between difference co-ordinate spaces we have 3 main transformation matrices</p>
<ul class="simple">
<li><p><strong>Model matrix</strong> - transforms the model space co-ordinates for the objects to the world space</p></li>
<li><p><strong>View matrix</strong> - transforms the world space co-ordinates to the view space co-ordinates</p></li>
<li><p><strong>Projection matrix</strong> - transforms the view space co-ordinates to the screen space NDC co-ordinates</p></li>
</ul>
<section id="the-model-matrix">
<span id="model-matrix-section"></span><h3><span class="section-number">6.3.1. </span>The Model matrix<a class="headerlink" href="#the-model-matrix" title="Permalink to this heading">#</a></h3>
<p>In <a class="reference internal" href="05_transformations.html#transformations-section"><span class="std std-ref">5. Transformations</span></a> we saw that we can combine transformations such as translation, scaling and rotation by multiplying the individual transformation matrices together. Lets compute a model matrix for our cube where it is scaled down by a factor of 0.5 in each co-ordinate direction, rotated about the <span class="math notranslate nohighlight">\(y\)</span>-axis using the time of the current frame as the rotation angle and translated backwards down the <span class="math notranslate nohighlight">\(z\)</span>-axis so that its centre is at <span class="math notranslate nohighlight">\((0, 0, -2)\)</span>. Add the following code inside the rendering loop before we call the <code class="docutils literal notranslate"><span class="pre">glDrawElements()</span></code> function.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Calculate the model matrix</span>
<span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">glfwGetTime</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">360.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0f</span><span class="p">);</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">translate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">));</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">scale</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">scale</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">));</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">rotate</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">model</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">translate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rotate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">scale</span><span class="p">;</span>
</pre></div>
</div>
<p>Here we have calculated the individual transformation matrices for translation, scaling and rotation and multiply them together to create the model matrix. The rotation angle has been calculated using the time of the current frame so that the cube will perform one full rotation every 3 seconds.</p>
</section>
<section id="the-view-matrix">
<span id="view-matrix-section"></span><h3><span class="section-number">6.3.2. </span>The View matrix<a class="headerlink" href="#the-view-matrix" title="Permalink to this heading">#</a></h3>
<p>To view the world space we create a virtual camera and place it in the world space. We need to translate the whole of the world space so that the camera is at <span class="math notranslate nohighlight">\((0,0,0)\)</span> and the rotate the world space so that the camera is pointing down the <span class="math notranslate nohighlight">\(z\)</span>-axis (<a class="reference internal" href="#view-space-figure"><span class="std std-numref">Fig. 6.5</span></a>).</p>
<figure class="align-default" id="view-space-figure">
<a class="reference internal image-reference" href="../_images/06_view_space.svg"><img alt="../_images/06_view_space.svg" src="../_images/06_view_space.svg" width="350" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.5 </span><span class="caption-text">The view space.</span><a class="headerlink" href="#view-space-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>To calculate the world space to view space transformation we require three vectors</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{eye}\)</span> – the co-ordinates of the camera position</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{target}\)</span> – the co-ordinates of the target point that the camera is pointing</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{worldUp}\)</span> – a vector pointing straight up in the world space which allows us to orientate the camera, this is usually <span class="math notranslate nohighlight">\((0, 1, 0)\)</span></p></li>
</ul>
<figure class="align-default" id="view-space-alignment-figure">
<a class="reference internal image-reference" href="../_images/06_view_space_alignment.svg"><img alt="../_images/06_view_space_alignment.svg" src="../_images/06_view_space_alignment.svg" width="400" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.6 </span><span class="caption-text">The vectors used in the transformation to the view space.</span><a class="headerlink" href="#view-space-alignment-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The <span class="math notranslate nohighlight">\(\mathbf{eye}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{target}\)</span> vectors are either determined by the user through keyboard, mouse or controller inputs or through some predetermined routine. To determine the view space transformation we first translate the camera position by the vector <span class="math notranslate nohighlight">\(-\mathbf{eye}\)</span> so that it is at <span class="math notranslate nohighlight">\((0, 0, 0)\)</span> using the following translation matrix</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    Translate =
    \begin{pmatrix}
        1 &amp; 0 &amp; 0 &amp; -\mathbf{eye}_x \\
        0 &amp; 1 &amp; 0 &amp; -\mathbf{eye}_y \\
        0 &amp; 0 &amp; 1 &amp; -\mathbf{eye}_z \\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{pmatrix}
\end{align*}, \end{split}\]</div>
<p>The next step is to align the world space so that the direction vector is pointing down the <span class="math notranslate nohighlight">\(z\)</span>-axis. To do this we use vectors <span class="math notranslate nohighlight">\(\mathbf{right}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{up}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{front}\)</span> which are unit vectors at right-angles to each other the point in directions relative to the camera (<a class="reference internal" href="#view-space-alignment-figure"><span class="std std-numref">Fig. 6.6</span></a>).</p>
<p>The <span class="math notranslate nohighlight">\(\mathbf{front}\)</span> vector points directly forward of the camera and is calculated using</p>
<div class="math notranslate nohighlight">
\[ \mathbf{front} = \frac{\mathbf{target} - \mathbf{eye}}{\| \mathbf{target} - \mathbf{eye}\|}.\]</div>
<p>The <span class="math notranslate nohighlight">\(\mathbf{right}\)</span> vector points to the right of the camera so is at right-angles to both the <span class="math notranslate nohighlight">\(\mathbf{front}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{worldUp}\)</span> vectors. We can use the <a class="reference internal" href="04_vectors_and_matrices.html#cross-product-section"><span class="std std-ref">cross product</span></a> between the two vectors to calculate this (note that the order of the vectors is important).</p>
<div class="math notranslate nohighlight">
\[ \mathbf{right} = \frac{\mathbf{front} \times \mathbf{worldUp}}{\| \mathbf{front} \times \mathbf{worldUp} \|}.\]</div>
<p>The <span class="math notranslate nohighlight">\(\mathbf{up}\)</span> vector points in the up direction of the camera and is at right-angles to the <span class="math notranslate nohighlight">\(\mathbf{front}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{right}\)</span> vectors we have already calculated. So this can be calculated using another cross product (we don’t need to normalise this this both <span class="math notranslate nohighlight">\(\mathbf{right}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{front}\)</span> are unit vectors).</p>
<div class="math notranslate nohighlight">
\[ \mathbf{up} = \mathbf{right} \times \mathbf{front}.\]</div>
<p>Once these vectors have been calculated the transformation matrix to rotate the <span class="math notranslate nohighlight">\(\mathbf{front}\)</span> vector so that it points down the <span class="math notranslate nohighlight">\(z\)</span>-axis is</p>
<div class="math notranslate nohighlight">
\[\begin{split} Rotate = \begin{pmatrix}
     \mathbf{right}_x &amp;  \mathbf{right}_y &amp;  \mathbf{right}_z &amp; 0 \\
     \mathbf{up}_x    &amp;  \mathbf{up}_y    &amp;  \mathbf{up}_z    &amp; 0 \\
    -\mathbf{front}_x &amp; -\mathbf{front}_y &amp; -\mathbf{front}_z &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}.\end{split}\]</div>
<p>The translation matrix and rotation matrix are multiplied together to form the view matrix which transforms the world space co-ordinates to the view space.</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \view &amp;= Rotate \cdot Translate \\
    &amp;=
    \begin{pmatrix}
         \mathbf{right}_x &amp;  \mathbf{right}_y &amp;  \mathbf{right}_z &amp; 0 \\
         \mathbf{up}_x    &amp;  \mathbf{up}_y    &amp;  \mathbf{up}_z    &amp; 0 \\
        -\mathbf{front}_x &amp; -\mathbf{front}_y &amp; -\mathbf{front}_z &amp; 0 \\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{pmatrix}
    \begin{pmatrix}
        1 &amp; 0 &amp; 0 &amp; -\mathbf{eye}_x \\
        0 &amp; 1 &amp; 0 &amp; -\mathbf{eye}_y \\
        0 &amp; 0 &amp; 1 &amp; -\mathbf{eye}_z \\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{pmatrix} \\
    &amp;=
    \begin{pmatrix}
        \mathbf{right}_x  &amp; \mathbf{right}_y  &amp; \mathbf{right}_z  &amp; -\mathbf{eye}_x \cdot \mathbf{right} \\
        \mathbf{up}_x     &amp; \mathbf{up}_y     &amp; \mathbf{up}_z     &amp; -\mathbf{eye}_y \cdot \mathbf{up} \\
        -\mathbf{front}_x &amp; -\mathbf{front}_y &amp; -\mathbf{front}_z &amp;  \mathbf{eye}_z \cdot \mathbf{front} \\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{pmatrix}
\end{align*} \end{split}\]</div>
<p>So the transposed view matrix is</p>
<div class="math notranslate nohighlight" id="equation-lookat-matrix-equation">
<span class="eqno">(6.1)<a class="headerlink" href="#equation-lookat-matrix-equation" title="Permalink to this equation">#</a></span>\[\begin{split} \view = \begin{pmatrix}
        \mathbf{right}_x &amp; \mathbf{up}_x &amp; -\mathbf{front}_x &amp; 0 \\
        \mathbf{right}_y &amp; \mathbf{up}_y &amp; -\mathbf{front}_y &amp; 0 \\
        \mathbf{right}_z &amp; \mathbf{up}_z &amp; -\mathbf{front}_z &amp; 0 \\
        -\mathbf{eye} \cdot \mathbf{right} &amp; -\mathbf{eye} \cdot \mathbf{up} &amp; \mathbf{eye} \cdot \mathbf{front} &amp; 1 \\
    \end{pmatrix} \end{split}\]</div>
<p>Lets move the camera to the right, back and up a bit so that it is at <span class="math notranslate nohighlight">\((1, 1, 1)\)</span> looking towards the center of the cube which is at <span class="math notranslate nohighlight">\((0, 0, -2)\)</span>. Add the following code after we have calculated the model matrix.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Calculate the view matrix</span>
<span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">eye</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
<span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">target</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">);</span>
<span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">worldUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span>
<span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">front</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">target</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">eye</span><span class="p">);</span>
<span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">right</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">cross</span><span class="p">(</span><span class="n">front</span><span class="p">,</span><span class="w"> </span><span class="n">worldUp</span><span class="p">));</span>
<span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">up</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">cross</span><span class="p">(</span><span class="n">right</span><span class="p">,</span><span class="w"> </span><span class="n">front</span><span class="p">);</span>

<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">front</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">front</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="n">view</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">front</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="n">view</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">glm</span><span class="o">::</span><span class="n">dot</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p">);</span>
<span class="n">view</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">glm</span><span class="o">::</span><span class="n">dot</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">);</span>
<span class="n">view</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">glm</span><span class="o">::</span><span class="n">dot</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">front</span><span class="p">);</span>
</pre></div>
</div>
<p>Here we have specified the <span class="math notranslate nohighlight">\(\mathbf{eye}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{target}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{worldUp}\)</span> vectors and use them to calculate the <span class="math notranslate nohighlight">\(\mathbf{front}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{right}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{up}\)</span> camera vectors. We then use these to calculate the view matrix.</p>
</section>
<section id="the-projection-matrix">
<h3><span class="section-number">6.3.3. </span>The Projection matrix<a class="headerlink" href="#the-projection-matrix" title="Permalink to this heading">#</a></h3>
<p>The next step is to project the view space onto the screen space. The simplest type of projection is <strong>orthographic projection</strong> where the co-ordinates in the view space are transformed to the screen space by simple translation and scaling transformations.</p>
<p>The region of the view space that will form the screen space is defined by a cuboid bounded by a left, right, bottom, top, near and far clipping planes. Any objects outside of the cuboid are clipped (<a class="reference internal" href="#orthographic-projection-figure"><span class="std std-numref">Fig. 6.7</span></a>).</p>
<figure class="align-default" id="orthographic-projection-figure">
<a class="reference internal image-reference" href="../_images/06_orthographic_projection.svg"><img alt="../_images/06_orthographic_projection.svg" src="../_images/06_orthographic_projection.svg" width="700" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.7 </span><span class="caption-text">Orthographic projection.</span><a class="headerlink" href="#orthographic-projection-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The transpose of the orthographic projection matrix is calculated using</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    Projection_{orth} =
    \begin{pmatrix}
        \dfrac{2}{right - left} &amp; 0 &amp; 0 &amp; 0 \\
        0 &amp; \dfrac{2}{top - bottom} &amp; 0 &amp; 0 \\
        0 &amp; 0 &amp; \dfrac{2}{near - far} &amp; 0 \\
        -\dfrac{right + left}{right - left} &amp; -\dfrac{top + bottom}{top - bottom} &amp; \dfrac{near + far}{near - far} &amp; 1
    \end{pmatrix}
\end{align*}, \end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(left\)</span>, <span class="math notranslate nohighlight">\(right\)</span>, <span class="math notranslate nohighlight">\(bottom\)</span>, <span class="math notranslate nohighlight">\(top\)</span>, <span class="math notranslate nohighlight">\(near\)</span> and <span class="math notranslate nohighlight">\(far\)</span> are the co-ordinates of the edges of the visible space. You don’t really need to know how this matrix is derived but if you are interested click on the dropdown link below.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Derivation of the orthographic projection matrix<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">To derive the orthographic projection we first need to translate the co-ordinates so that the centre of the cuboid that represents the clipping volume to <span class="math notranslate nohighlight">\((0,0,0)\)</span>. The centre co-ordinates are calculated using the average of the edge co-ordinates, e.g., for the <span class="math notranslate nohighlight">\(x\)</span> co-ordinate this would be <span class="math notranslate nohighlight">\(\dfrac{right + left}{2}\)</span>, so the translation matrix is</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    Translate =
    \begin{pmatrix}
        1 &amp; 0 &amp; 0 &amp; -\dfrac{right + left}{2}  \\
        0 &amp; 1 &amp; 0 &amp; -\dfrac{top + bottom}{2} \\
        0 &amp; 0 &amp; 1 &amp;  \dfrac{near + far}{2}  \\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{pmatrix}
\end{align*} \end{split}\]</div>
<p class="sd-card-text">The second step is to scale the clipping volume so that the co-ordinates are between <span class="math notranslate nohighlight">\(-1\)</span> and <span class="math notranslate nohighlight">\(1\)</span>. This is done by dividing the distance between the edges of the screen space by the distance between the clipping planes, e.g., for the <span class="math notranslate nohighlight">\(x\)</span> co-ordinate this would be <span class="math notranslate nohighlight">\(\dfrac{1 - (-1)}{right - left}=\dfrac{2}{right - left}\)</span>, so the scaling matrix is</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    Scale =
    \begin{pmatrix}
        \dfrac{2}{right - left} &amp; 0 &amp; 0 &amp; 0 \\
        0 &amp; \dfrac{2}{top - bottom} &amp; 0 &amp; 0 \\
        0 &amp; 0 &amp; \dfrac{2}{near - far} &amp; 0 \\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{pmatrix}.
\end{align*} \end{split}\]</div>
<p class="sd-card-text">Combining the translation and scaling matrices gives the orthographic projection matrix</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    Projection_{orth} &amp;= Translate \cdot Scale \\
    &amp;=
    \begin{pmatrix}
        \dfrac{2}{right - left} &amp; 0 &amp; 0 &amp; -\dfrac{right + left}{right - left} \\
        0 &amp; \dfrac{2}{top - bottom} &amp; 0 &amp; -\dfrac{top + bottom}{top - bottom} \\
        0 &amp; 0 &amp; \dfrac{2}{near - far}   &amp;  \dfrac{near + far}{near - far} \\
        0 &amp; 0 &amp; 0 &amp; 1
    \end{pmatrix}
\end{align*} \end{split}\]</div>
</div>
</details><p>Lets calculate the orthographic projection matrix using <span class="math notranslate nohighlight">\(left = -2\)</span>, <span class="math notranslate nohighlight">\(right = 2\)</span>, <span class="math notranslate nohighlight">\(bottom = -2\)</span>, <span class="math notranslate nohighlight">\(top = 2\)</span>, <span class="math notranslate nohighlight">\(near = 0\)</span>, <span class="math notranslate nohighlight">\(far = 10\)</span>. Add the following code after we have calculated the view matrix.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Calculate orthographic projection matrix</span>
<span class="kt">float</span><span class="w"> </span><span class="n">left</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">,</span><span class="w"> </span><span class="n">right_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">;</span>
<span class="kt">float</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">,</span><span class="w"> </span><span class="n">top</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">;</span>
<span class="kt">float</span><span class="w"> </span><span class="n">near</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="n">far</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0f</span><span class="p">;</span>

<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">right_</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">left</span><span class="p">);</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">top</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bottom</span><span class="p">);</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">near</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">far</span><span class="p">);</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">right_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">left</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">right_</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">left</span><span class="p">);</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">top</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bottom</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">top</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bottom</span><span class="p">);</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="n">near</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">far</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">near</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">far</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="the-mvp-matrix">
<h3><span class="section-number">6.3.4. </span>The MVP matrix<a class="headerlink" href="#the-mvp-matrix" title="Permalink to this heading">#</a></h3>
<p>Now that we have the model, view and projection matrices we need to apply them to our objects. We could do this in our <code class="docutils literal notranslate"><span class="pre">main()</span></code> function but this would mean sending lots of vertex buffers to the GPU and very inefficient. Much better to send a single <span class="math notranslate nohighlight">\(4 \times 4\)</span> matrix to the shader and perform the calculations using the GPU since the vertex buffer is already in the GPU memory.</p>
<p>So in our <code class="docutils literal notranslate"><span class="pre">main()</span></code> function we combine the model, view and projection matrices to form a single matrix called the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix.</p>
<div class="math notranslate nohighlight">
\[ MV\!P = Projection \cdot \view \cdot \model. \]</div>
<p>We need a way to send the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix to the vertex shader. We do this using a uniform in the same way as we did for the texture locations in <a class="reference internal" href="03_textures.html#uniforms-section"><span class="std std-ref">3. Textures</span></a>, enter the following code after we have calculated the projection matrix.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Send MVP matrix to the vertex shader</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">MVP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<span class="n">glUniformMatrix4fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shaderID</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MVP&quot;</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MVP</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
<p>Here after calculating the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix we get the location of the uniform and point OpenGL to the first element of the matrix using the <a href="https://registry.khronos.org/OpenGL-Refpages/gl4/html/glUniform.xhtml" target="_blank"><code class="docutils literal notranslate"><span class="pre">glUniformMatrix4fv()</span></code></a> function.</p>
<p>We also need to update the vertex shader so that is uses the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix. Edit the <strong>vertexShader.glsl</strong> file in the <strong>Lab06_3D_Worlds</strong> project so that the <code class="docutils literal notranslate"><span class="pre">gl_Position</span></code> vector is calculated by applying the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix to the vertex position.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#version 330 core</span>

<span class="c1">// Inputs</span>
<span class="n">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="n">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">vec2</span><span class="w"> </span><span class="n">uv</span><span class="p">;</span>

<span class="c1">// Outputs</span>
<span class="n">out</span><span class="w"> </span><span class="n">vec2</span><span class="w"> </span><span class="n">UV</span><span class="p">;</span>

<span class="c1">// Uniforms</span>
<span class="n">uniform</span><span class="w"> </span><span class="n">mat4</span><span class="w"> </span><span class="n">mvp</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Output vertex position</span>
<span class="w">    </span><span class="n">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mvp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec4</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// Output texture co-ordinates</span>
<span class="w">    </span><span class="n">UV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uv</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compile and run the program and you should see the following.</p>
<center>
<video controls muted="true" loop="true" width="500">
    <source src="../_static/06_orthogonal_cube_no_depth_test.mp4" type="video/mp4">
</video>
</center>
</section>
</section>
<hr class="docutils" />
<section id="the-depth-test">
<h2><span class="section-number">6.4. </span>The depth test<a class="headerlink" href="#the-depth-test" title="Permalink to this heading">#</a></h2>
<p>Our rendering of the cube doesn’t look quite right. What is happening here is that some parts of the sides of the cube that are further away from where we are viewing it (e.g., the bottom side) have been rendered after the sides that are closer to us (<a class="reference internal" href="#depth-test-1-figure"><span class="std std-numref">Fig. 6.8</span></a>).</p>
<figure class="align-default" id="depth-test-1-figure">
<a class="reference internal image-reference" href="../_images/06_depth_test.svg"><img alt="../_images/06_depth_test.svg" src="../_images/06_depth_test.svg" width="300" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.8 </span><span class="caption-text">Rendering the far triangle after the near triangle.</span><a class="headerlink" href="#depth-test-1-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>To overcome this issue OpenGL uses a <strong>depth test</strong> when computing the fragment shader. When OpenGL creates a frame buffer it also creates another buffer called a <strong>z buffer</strong> (or <strong>depth buffer</strong>) where the <span class="math notranslate nohighlight">\(z\)</span> co-ordinate of each pixel in the frame buffer is stored and initialises all the values to <span class="math notranslate nohighlight">\(-1\)</span> (the furthest possible <span class="math notranslate nohighlight">\(z\)</span> co-ordinate in the screen space). When the fragment shader is called it checks whether the fragment has a <span class="math notranslate nohighlight">\(z\)</span> co-ordinate more than that already stored in the depth buffer and if so it updates the colour of the fragment and stores its <span class="math notranslate nohighlight">\(z\)</span> co-ordinate in the depth-buffer as the current nearest fragment (if the fragment has a <span class="math notranslate nohighlight">\(z\)</span> co-ordinate less than what is already in the depth buffer the fragment shader does nothing). This means once the fragment shader has been called for all fragments of all objects, the pixels contain colours of the objects closest to the camera.</p>
<p>To enable depth testing we simply add the following function before after the creation of the window.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Enable depth test</span>
<span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEPTH_TEST</span><span class="p">);</span>
</pre></div>
</div>
<p>We also need to clear the depth buffer at the start of each frame, change <code class="docutils literal notranslate"><span class="pre">glClear(GL_COLOR_BUFFER_BIT);</span></code> to the following.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Clear the window</span>
<span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span>
</pre></div>
</div>
<p>Make these changes to your code and you should get a much better result.</p>
<center>
<video controls muted="true" loop="true" width="500">
    <source src="../_static/06_orthogonal_cube_depth_test.mp4" type="video/mp4">
</video>
</center>
</section>
<hr class="docutils" />
<section id="perspective-projection">
<h2><span class="section-number">6.5. </span>Perspective projection<a class="headerlink" href="#perspective-projection" title="Permalink to this heading">#</a></h2>
<p>The problem with using orthographic projection is that is does not give us any clues to how far an object is from the viewer. We would expect that objects further away from the camera would appear smaller whereas objects closer to the camera would appear larger.</p>
<p>Perspective project uses the same near and far clipping planes as orthographic projection but the clipping planes on the sides are not parallel, rather they angle in such that the four planes meet at <span class="math notranslate nohighlight">\((0,0,0)\)</span> (<a class="reference internal" href="#perspective-projection-figure"><span class="std std-numref">Fig. 6.9</span></a>). The clipping volume bounded by the size clipping planes is called the <strong>viewing frustum</strong>.</p>
<figure class="align-default" id="perspective-projection-figure">
<a class="reference internal image-reference" href="../_images/06_perspective_projection.svg"><img alt="../_images/06_perspective_projection.svg" src="../_images/06_perspective_projection.svg" width="600" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.9 </span><span class="caption-text">Perspective projection.</span><a class="headerlink" href="#perspective-projection-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The shape of the viewing frustum is determined by four factors:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(near\)</span> – the distance from <span class="math notranslate nohighlight">\((0,0,0)\)</span> to the near clipping plane</p></li>
<li><p><span class="math notranslate nohighlight">\(far\)</span> – the distance from <span class="math notranslate nohighlight">\((0,0,0)\)</span> to the far clipping plane</p></li>
<li><p><span class="math notranslate nohighlight">\(fov\)</span> – the <strong>field of view</strong> angle between the bottom and top clipping planes (used to determine how much of the view space is visible)</p></li>
<li><p><span class="math notranslate nohighlight">\(aspect\)</span> – the width-to-height <strong>aspect ratio</strong> of the window</p></li>
</ul>
<p>Given these four factors we can calculate the transpose of the perspective projection matrix using</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    Projection_{pers} =
    \begin{pmatrix}
        \dfrac{near}{right} &amp; 0 &amp; 0 &amp; 0 \\
        0 &amp; \dfrac{near}{top} &amp; 0 &amp; 0 \\
        0 &amp; 0 &amp; -\dfrac{far + near}{far - near} &amp; -1 \\
        0 &amp; 0 &amp; - \dfrac{2\times far \times near}{far - near} &amp; 0
    \end{pmatrix},
\end{align*} \end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(top = near \times \tan\left(\dfrac{fov}{2}\right)\)</span> and <span class="math notranslate nohighlight">\(right = aspect \times top\)</span>. You don’t really need to know how this is derived but it you are interested click on the dropdown below.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Derivation of the perspective projection matrix<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The mapping of a point in the view space with co-ordinates <span class="math notranslate nohighlight">\((x, y, z)\)</span> onto the near clipping plane to the point <span class="math notranslate nohighlight">\((x', y', -near)\)</span> is shown in <a class="reference internal" href="#perspective-mapping-figure"><span class="std std-numref">Fig. 6.10</span></a>.</p>
<figure class="align-default" id="perspective-mapping-figure">
<a class="reference internal image-reference" href="../_images/06_perspective_projection_mapping.svg"><img alt="../_images/06_perspective_projection_mapping.svg" src="../_images/06_perspective_projection_mapping.svg" width="500" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.10 </span><span class="caption-text">Mapping of the point at <span class="math notranslate nohighlight">\((x,y,z)\)</span> onto the near plane using perspective.</span><a class="headerlink" href="#perspective-mapping-figure" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p class="sd-card-text">The ratio of <span class="math notranslate nohighlight">\(x\)</span> to <span class="math notranslate nohighlight">\(-z\)</span> distance is the same as the ratio of <span class="math notranslate nohighlight">\(x'\)</span> to <span class="math notranslate nohighlight">\(near\)</span> distance (and similar for <span class="math notranslate nohighlight">\(y'\)</span>) so</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \dfrac{x}{-z} &amp;= \dfrac{x'}{near} &amp;\implies
    x' &amp;= -near \frac{x}{z}, \\
    \dfrac{y}{-z} &amp;= \dfrac{y'}{near} &amp;\implies
    y' &amp;= -near \frac{y}{z},
\end{align*} \end{split}\]</div>
<p class="sd-card-text">So we are mapping <span class="math notranslate nohighlight">\((x, y)\)</span> to <span class="math notranslate nohighlight">\(\left( -near \dfrac{x}{z}, -near \dfrac{y}{z} \right)\)</span>. As well as the perspective mapping we also need to ensure that the mapped co-ordinates <span class="math notranslate nohighlight">\((x', y', z')\)</span> are between <span class="math notranslate nohighlight">\(-1\)</span> and <span class="math notranslate nohighlight">\(1\)</span>. Consider the mapping of the <span class="math notranslate nohighlight">\(x\)</span> co-ordinate</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    left &amp;\leq x' \leq right \\
    -right &amp;\leq x' \leq right  &amp;&amp; \textsf{(since $left = -right$)} \\
    -1 &amp;\leq \frac{x'}{right} \leq 1 &amp;&amp; \textsf{(divide by $right$)}
\end{align*} \end{split}\]</div>
<p class="sd-card-text">Since <span class="math notranslate nohighlight">\(x' = -near\dfrac{x}{z}\)</span> then</p>
<div class="math notranslate nohighlight">
\[ \begin{align*}
    -1 &amp;\leq -\frac{near}{right}\frac{x}{z}\leq 1
\end{align*} \]</div>
<p class="sd-card-text">and doing similar for <span class="math notranslate nohighlight">\(y\)</span> we get</p>
<div class="math notranslate nohighlight">
\[ \begin{align*}
    -1 &amp;\leq -\frac{near}{top}\frac{y}{z}\leq 1
\end{align*} \]</div>
<p class="sd-card-text">If we use <a class="reference internal" href="05_transformations.html#homogeneous-coordinates-section"><span class="std std-ref">homogeneous co-ordinates</span></a> then this mapping can be represented by the matrix equation</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \begin{pmatrix}
        \dfrac{near}{right} &amp; 0 &amp; 0 &amp; 0 \\
        0 &amp; \dfrac{near}{top} &amp; 0 &amp; 0 \\
        0 &amp; 0 &amp; A &amp; B \\
        0 &amp; 0 &amp; -1 &amp; 0
    \end{pmatrix}
    \begin{pmatrix} x \\ y \\ z \\ 1 \end{pmatrix}
    =
    \begin{pmatrix} \dfrac{near}{right}x \\ \dfrac{near}{top}y \\ Az + B \\ -z \end{pmatrix}
\end{align*} \end{split}\]</div>
<p class="sd-card-text">where <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> are placeholder variables for now. Since we divide homogeneous co-ordinates by the fourth element then the projected co-ordinates are</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \begin{pmatrix} x' \\ y' \\ z' \\ 1 \end{pmatrix} =
    \begin{pmatrix}
        -\dfrac{near}{right}\dfrac{x}{z} \\
        -\dfrac{near}{top}\dfrac{y}{z} \\
        \dfrac{Az + B}{-z} \\
        1
    \end{pmatrix}.
\end{align*} \end{split}\]</div>
<p class="sd-card-text">So the mapping for <span class="math notranslate nohighlight">\(x'\)</span> and <span class="math notranslate nohighlight">\(y'\)</span> is correct. We need <span class="math notranslate nohighlight">\(z'\)</span> to be between <span class="math notranslate nohighlight">\(-1\)</span> and <span class="math notranslate nohighlight">\(1\)</span> so <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> must satisfy</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \textsf{near plane:} &amp;&amp;\frac{Az + B}{-z} &amp;= -1, &amp; \implies  Az + B &amp;= z, \\
    \textsf{far plane:} &amp;&amp; \frac{Az + B}{-z} &amp;= 1, &amp; \implies Az + B &amp;= -z.
\end{align*} \end{split}\]</div>
<p class="sd-card-text">At the near clipping plane <span class="math notranslate nohighlight">\(z = -n\)</span> and at the far clipping plane <span class="math notranslate nohighlight">\(z = -f\)</span> so</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    -A \times near + B &amp;= -near, \\
    -A \times far + B &amp;= far.
\end{align*} \end{split}\]</div>
<p class="sd-card-text">Subtracting the first equation from the second gives</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    -A (far - near) &amp;= far + near \\
    \therefore A &amp;= -\frac{far + near}{far - near}.
\end{align*} \end{split}\]</div>
<p class="sd-card-text">Substituting <span class="math notranslate nohighlight">\(A\)</span> in the second equation gives</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \left(\frac{far + near}{far - near}\right) near + B &amp;= -near \\
    B &amp;= -near \left( 1 +  \frac{far + near}{far - near}\right) \\
    &amp;= -near \left( \frac{far - near + far + near}{far - near}\right) \\
    &amp;= - \frac{2 \times far \times near}{far - near}.
\end{align*} \end{split}\]</div>
<p class="sd-card-text">So the perspective projection matrix is</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    Projection_{pers} =
    \begin{pmatrix}
        \dfrac{near}{right} &amp; 0 &amp; 0 &amp; 0 \\
        0 &amp; \dfrac{near}{top} &amp; 0 &amp; 0 \\
        0 &amp; 0 &amp; -\dfrac{far + near}{far - near} &amp; - \dfrac{2\times far \times near}{far - near} \\
        0 &amp; 0 &amp; -1 &amp; 0
    \end{pmatrix}.
\end{align*} \end{split}\]</div>
<p class="sd-card-text">We now need to calculate the values of <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(t\)</span>. The <span class="math notranslate nohighlight">\(t\)</span> co-ordinate is the opposite side of a right angled triangle with angle <span class="math notranslate nohighlight">\(\dfrac{fov}{2}\)</span> and adjacent side <span class="math notranslate nohighlight">\(n\)</span> so it is easily calculated using trigonometry</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \tan \left( \frac{fov}{2} \right) 
    &amp;= \frac{top}{near} \\
    t &amp;= near \tan \left( \frac{fov}{2} \right).
\end{align*} \end{split}\]</div>
<p class="sd-card-text">Since <span class="math notranslate nohighlight">\(aspect\)</span> with the width of the window divided by the height and <span class="math notranslate nohighlight">\(l = -r\)</span> and <span class="math notranslate nohighlight">\(b = -t\)</span> then</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    aspect &amp;= \frac{right - left}{top - bottom} = \frac{2 \times right}{2 \times top} \\
    \therefore right &amp;= aspect \times top.
\end{align*} \end{split}\]</div>
</div>
</details><p>Lets apply perspective projection to our cube using a near and far clipping planes at <span class="math notranslate nohighlight">\(n=0.2\)</span> and <span class="math notranslate nohighlight">\(f=10\)</span> respectively and a field of view angle of <span class="math notranslate nohighlight">\(fov = 45^\circ\)</span>. Comment out the code use to calculate the orthogonal projection matrix and add the following code (note that here we use <code class="docutils literal notranslate"><span class="pre">right_</span></code> because we’ve already used <code class="docutils literal notranslate"><span class="pre">right</span></code> to calculate the view matrix).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Calculate perspective projection matrix</span>
<span class="kt">float</span><span class="w"> </span><span class="n">fov</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">45.0f</span><span class="p">);</span>
<span class="kt">float</span><span class="w"> </span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1024.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">768.0f</span><span class="p">;</span>
<span class="kt">float</span><span class="w"> </span><span class="n">near</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">;</span>
<span class="kt">float</span><span class="w"> </span><span class="n">far</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0f</span><span class="p">;</span>
<span class="kt">float</span><span class="w"> </span><span class="n">top</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tan</span><span class="p">(</span><span class="n">fov</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">);</span>
<span class="kt">float</span><span class="w"> </span><span class="n">right_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aspect</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">top</span><span class="p">;</span>

<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">right_</span><span class="p">;</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">top</span><span class="p">;</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">far</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">near</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">far</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">near</span><span class="p">);</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">;</span>
<span class="n">projection</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.0f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">far</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">far</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">near</span><span class="p">);</span>
</pre></div>
</div>
<p>Run your program and you should see the following.</p>
<center>
<video controls muted="true" loop="true" width="500">
    <source src="../_static/06_perspective_cube.mp4" type="video/mp4">
</video>
</center>
<section id="changing-the-fov-angle">
<span id="changing-the-fov-section"></span><h3><span class="section-number">6.5.1. </span>Changing the fov angle<a class="headerlink" href="#changing-the-fov-angle" title="Permalink to this heading">#</a></h3>
<p>The field of view angle determines how much of the view space we can see in the screen space where the larger the angle the more we can see. When we increase the field of view angle it appears to the user that our view is zooming out whereas a decrease has the effect of zooming in (this is used a lot in first person shooter games to model the effect of a pair of binoculars or a sniper scope).</p>
<p>Experiment with the affect of changing the field of view angle.</p>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row docutils">
<div class="sd-col sd-d-flex-column docutils">
<figure class="align-default" id="id2">
<img alt="../_images/06_fov_15.png" src="../_images/06_fov_15.png" />
<figcaption>
<p><span class="caption-number">Fig. 6.11 </span><span class="caption-text"><span class="math notranslate nohighlight">\(fov = 15^\circ\)</span></span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
<div class="sd-col sd-d-flex-column docutils">
<figure class="align-default" id="id3">
<img alt="../_images/06_fov_90.png" src="../_images/06_fov_90.png" />
<figcaption>
<p><span class="caption-number">Fig. 6.12 </span><span class="caption-text"><span class="math notranslate nohighlight">\(fov = 90^\circ\)</span></span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="a-camera-class">
<h2><span class="section-number">6.6. </span>A camera class<a class="headerlink" href="#a-camera-class" title="Permalink to this heading">#</a></h2>
<p>Our render loop is starting to look a bit messy so we are going to create a <code class="docutils literal notranslate"><span class="pre">Camera</span></code> class to handle all operations relating to the calculation of the view and projection matrices. In the <strong>common/</strong> folder there is a header file and code file called <strong>camera.hpp</strong> and <strong>camera.cpp</strong> which are currently empty. Enter the following code into <strong>camera.hpp</strong>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;common/maths.hpp&gt;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Camera</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Projection parameters</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">fov</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">45.0f</span><span class="p">);</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1024.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">768.0f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">near</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">far</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0f</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Camera vectors</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">eye</span><span class="p">;</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">target</span><span class="p">;</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">worldUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Transformation matrices</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">Camera</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">target</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Methods</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">calculateMatrices</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</div>
<p>You should be familiar with class declarations by now. Here we have declared a <code class="docutils literal notranslate"><span class="pre">Camera</span></code> class with attributes of the floats for the projection parameters, glm vector objects for the camera vectors and glm matrix objects for the view and projection matrices.</p>
<p>In the <strong>camera.cpp</strong> file add the following code.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;common/camera.hpp&gt;</span>

<span class="n">Camera</span><span class="o">::</span><span class="n">Camera</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">Eye</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">Target</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">eye</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Eye</span><span class="p">;</span>
<span class="w">    </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Target</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">calculateMatrices</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Calculate the view matrix</span>
<span class="w">    </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">worldUp</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Calculate the projection matrix</span>
<span class="w">    </span><span class="n">projection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">perspective</span><span class="p">(</span><span class="n">fov</span><span class="p">,</span><span class="w"> </span><span class="n">aspect</span><span class="p">,</span><span class="w"> </span><span class="n">near</span><span class="p">,</span><span class="w"> </span><span class="n">far</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The Camera class constructor creates a camera object and instantiates the <span class="math notranslate nohighlight">\(\mathbf{eye}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{target}\)</span> vectors using the values of the two <code class="docutils literal notranslate"><span class="pre">glm::vec3</span></code> objects that are inputted. The <code class="docutils literal notranslate"><span class="pre">calculateMatrices()</span></code> method calculates the view and projection matrices. These both use functions from the <code class="docutils literal notranslate"><span class="pre">Maths</span></code> class which we haven’t yet defined so lets do this now. In the <code class="docutils literal notranslate"><span class="pre">Maths</span></code> class declare the following functions.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// View and projection matrices</span>
<span class="k">static</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="nf">lookAt</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">worldUp</span><span class="p">);</span>
<span class="k">static</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="nf">perspective</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">fov</span><span class="p">,</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">aspect</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">near</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">far</span><span class="p">);</span>
</pre></div>
</div>
<p>Then define these functions in the <strong>maths.cpp</strong> file.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="nf">Maths::lookAt</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">worldUp</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">target</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">eye</span><span class="p">);</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">cross</span><span class="p">(</span><span class="n">front</span><span class="p">,</span><span class="w"> </span><span class="n">worldUp</span><span class="p">));</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">up</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">cross</span><span class="p">(</span><span class="n">right</span><span class="p">,</span><span class="w"> </span><span class="n">front</span><span class="p">);</span>

<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="w">    </span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">front</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">front</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="n">view</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">front</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="w">    </span><span class="n">view</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">glm</span><span class="o">::</span><span class="n">dot</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p">);</span>
<span class="w">    </span><span class="n">view</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">glm</span><span class="o">::</span><span class="n">dot</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">);</span>
<span class="w">    </span><span class="n">view</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">glm</span><span class="o">::</span><span class="n">dot</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span><span class="w"> </span><span class="n">front</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="nf">Maths::perspective</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">fov</span><span class="p">,</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">aspect</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">near</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">far</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">top</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tan</span><span class="p">(</span><span class="n">fov</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">);</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aspect</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">top</span><span class="p">;</span>

<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<span class="w">    </span><span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">right</span><span class="p">;</span>
<span class="w">    </span><span class="n">projection</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">top</span><span class="p">;</span>
<span class="w">    </span><span class="n">projection</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">far</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">near</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">far</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">near</span><span class="p">);</span>
<span class="w">    </span><span class="n">projection</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">projection</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.0f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">far</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">far</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">near</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>So now we have a <code class="docutils literal notranslate"><span class="pre">Camera</span></code> class lets use it to calculate our view and projection matrices. First create a <code class="docutils literal notranslate"><span class="pre">Camera</span></code> object by entering the following code before the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create camera object</span>
<span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">));</span>
</pre></div>
</div>
<p>Here we have placed the camera at <span class="math notranslate nohighlight">\((1, 1, 1)\)</span> pointing towards <span class="math notranslate nohighlight">\((0, 0, -2)\)</span> (the same as before). We then need to calculate the view and projection matrices just before we calculate the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix by adding the following code.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Calculate view and projection matrices</span>
<span class="n">camera</span><span class="p">.</span><span class="n">calculateMatrices</span><span class="p">();</span>
</pre></div>
</div>
<p>The last thing we need to do is to use the view and projection matrices from the <code class="docutils literal notranslate"><span class="pre">camera</span></code> object when calculating the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix. Edit your code so that it looks like the following.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Calculate the MVP matrix and send it to the vertex shader</span>
<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">MVP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
</pre></div>
</div>
<p>Compile and run your code to check that everything is working correctly. You can now comment out the codes used to calculate the view and projection matrices as this is no long used.</p>
<hr class="docutils" />
</section>
<section id="multiple-objects">
<span id="multiple-objects-section"></span><h2><span class="section-number">6.7. </span>Multiple objects<a class="headerlink" href="#multiple-objects" title="Permalink to this heading">#</a></h2>
<p>The last thing we are going to do in this lab is to add some more cubes to our 3D world. We can do this by defining the position of each cube and then, in the render loop, we loop through each cube and calculate its model matrix, calculate the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix and then render the current cube. Add the following code to your program before the render loop.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Cube positions</span>
<span class="n">vec3</span><span class="w"> </span><span class="n">cubePositions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">5.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-10.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="mf">-3.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-3.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="mf">-4.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-8.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-6.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="mf">-4.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">3.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-8.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-5.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="w"> </span><span class="mf">4.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-4.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="w"> </span><span class="mf">2.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">),</span>
<span class="w">    </span><span class="n">vec3</span><span class="p">(</span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0f</span><span class="p">)</span>
<span class="p">};</span>

<span class="c1">// Cube rotation angles</span>
<span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">cubeAngles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">20.0f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</pre></div>
</div>
<p>This creates two arrays of <code class="docutils literal notranslate"><span class="pre">glm::vec3</span></code> objects: <code class="docutils literal notranslate"><span class="pre">cubePositions</span></code> that contain the co-ordinates of the centres of 10 cubes and <code class="docutils literal notranslate"><span class="pre">cubeAngles</span></code> that contains a rotation angle based on the loop variable <code class="docutils literal notranslate"><span class="pre">i</span></code>. In the <strong>render loop</strong> replace the code used to calculate the <span class="math notranslate nohighlight">\(MV\!P\)</span> matrix and render the cube with the following.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Loop through cubes and draw each one</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Calculate the model matrix</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">translate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">cubePositions</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">scale</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">scale</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">));</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">rotate</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Maths</span><span class="o">::</span><span class="n">rotate</span><span class="p">(</span><span class="n">cubeAngles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">));</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">model</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">translate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rotate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">scale</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Calculate the MVP matrix</span>
<span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">MVP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Send MVP matrix to the vertex shader</span>
<span class="w">    </span><span class="n">glUniformMatrix4fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shaderID</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MVP&quot;</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                       </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MVP</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>

<span class="w">    </span><span class="c1">// Draw the triangles</span>
<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ELEMENT_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">EBO</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDrawElements</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">),</span>
<span class="w">                   </span><span class="n">GL_UNSIGNED_INT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here we loop through each of the 10 cubes and calculate the model matrix using the <code class="docutils literal notranslate"><span class="pre">cubePositions</span></code> and <code class="docutils literal notranslate"><span class="pre">cubeAngles</span></code> vectors. We need to change the position of the camera so that we can see all of the cubes. Add the following code before the view and projection matrices are calculated.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
</pre></div>
</div>
<p>This moves the camera position to <span class="math notranslate nohighlight">\((0, 0, 5)\)</span> looking towards <span class="math notranslate nohighlight">\((0, 0, 0)\)</span>. Run your program and you should see the following.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/06_multiple_cubes.png"><img alt="../_images/06_multiple_cubes.png" src="../_images/06_multiple_cubes.png" style="width: 500px;" /></a>
</figure>
</section>
<hr class="docutils" />
<section id="exercises">
<h2><span class="section-number">6.8. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Move the camera position so that it moves in a circle centred at the first cube with radius 10 with a rotation speed such that it completes one full rotation every 5 seconds. Hint: <span class="math notranslate nohighlight">\(x = c_x + r\cos(\theta)\)</span> and <span class="math notranslate nohighlight">\(z = c_z + r\sin(\theta)\)</span> gives the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> co-ordinates on a circle centred at <span class="math notranslate nohighlight">\((c_x, c_y, c_z)\)</span> with radius <span class="math notranslate nohighlight">\(r\)</span>.</p></li>
</ol>
<center>
<video controls muted="true" loop="true" width="400">
    <source src="../_static/06_Ex2.mp4" type="video/mp4">
</video>
</center>
<ol class="arabic simple" start="3">
<li><p>Rotate the cubes that have an odd index number about the vector <span class="math notranslate nohighlight">\((1,1,1)\)</span> so that they complete one full rotation every 2 seconds. Hint: <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">%</span> <span class="pre">y</span></code> returns the remainder when <code class="docutils literal notranslate"><span class="pre">x</span></code> is divided by <code class="docutils literal notranslate"><span class="pre">y</span></code>, e.g., <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">%</span> <span class="pre">2</span></code> will return <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
</ol>
<center>
<video controls muted="true" loop="true" width="400">
    <source src="../_static/06_Ex3.mp4" type="video/mp4">
</video>
</center>
<ol class="arabic simple" start="4">
<li><p>Add a feature to your program that allows the user to increase or decrease the field of view angle using the up and down arrow keys. Your code should limit the field of view angle so it is never less than <span class="math notranslate nohighlight">\(10^\circ\)</span> or greater than <span class="math notranslate nohighlight">\(90^\circ\)</span>. Hint: The <code class="docutils literal notranslate"><span class="pre">keyboardInput()</span></code> function at the bottom of the <strong>main.cpp</strong> file checks if the <a href="https://www.glfw.org/docs/3.3/group__keys.html" target="_blank">escape key</a> has been pressed and quits the application if it has.</p></li>
</ol>
<center>
<video controls muted="true" loop="true" width="400">
    <source src="../_static/06_Ex4.mp4" type="video/mp4">
</video>
</center>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./_pages"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="05_transformations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Transformations</p>
      </div>
    </a>
    <a class="right-next"
       href="07_Moving_the_camera.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Moving the camera</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#d-models">6.1. 3D models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#co-ordinate-systems">6.2. Co-ordinate systems</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-view-and-projection-matrices">6.3. Model, view and projection matrices</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model-matrix">6.3.1. The Model matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-view-matrix">6.3.2. The View matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-projection-matrix">6.3.3. The Projection matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-mvp-matrix">6.3.4. The MVP matrix</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-depth-test">6.4. The depth test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#perspective-projection">6.5. Perspective projection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-the-fov-angle">6.5.1. Changing the fov angle</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-camera-class">6.6. A camera class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-objects">6.7. Multiple objects</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">6.8. Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Jon Shiach
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>