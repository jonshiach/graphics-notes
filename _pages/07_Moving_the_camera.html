
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab 7: Moving the Camera &#8212; Computer Graphics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"vec": ["\\mathbf{#1}", 1]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_pages/07_Moving_the_camera';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab 8: Lighting" href="08_Lighting.html" />
    <link rel="prev" title="Lab 6: 3D Worlds" href="06_3D_worlds.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Computer Graphics - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Computer Graphics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Contents
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preliminaries</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="P_Core_concepts.html">Core Computer Graphics Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="P_Software.html">Visual Studio Code</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Labs</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_intro_to_javascript.html">Lab 1: Introduction to JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Basic_shapes.html">Lab 2: Drawing Basic Shapes in WebGL</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_Textures.html">Lab 3: Textures</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Vectors_and_matrices.html">Lab 4: Vectors and Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_Transformations.html">Lab 5: Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_3D_worlds.html">Lab 6: 3D Worlds</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab 7: Moving the Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_Lighting.html">Lab 8: Lighting</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_Normal_mapping.html">Lab 9: Normal Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_Quaternions.html">Lab 10: Quaternions</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jonshiach/graphics-notes" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jonshiach/graphics-notes/issues/new?title=Issue%20on%20page%20%2F_pages/07_Moving_the_camera.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/_pages/07_Moving_the_camera.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 7: Moving the Camera</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-keyboard-and-mouse-input">Getting keyboard and mouse input</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-keyboard-input-to-move-the-camera">Using keyboard input to move the camera</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-the-speed-of-the-camera">Controlling the speed of the camera</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-mouse-to-point-the-camera">Using the mouse to point the camera</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#yaw-pitch-and-roll">Yaw, pitch and roll</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#limiting-the-pitch-angle">Limiting the pitch angle</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#back-face-culling">Back face culling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#video-walkthrough">Video walkthrough</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-7-moving-the-camera">
<span id="moving-the-camera-section"></span><h1>Lab 7: Moving the Camera<a class="headerlink" href="#lab-7-moving-the-camera" title="Link to this heading">#</a></h1>
<p>In the <a class="reference internal" href="06_3D_worlds.html#d-worlds-section"><span class="std std-ref">Lab 6: 3D Worlds</span></a> we saw how we use transformations to build a 3D world, align the world to the camera position and project the view space onto the screen space. We also created a Camera class to contains methods to perform these calculations. The next step is to obtain keyboard and mouse input and modify the Camera class to be able to move and direct the camera around the 3D world.</p>
<div class="tip admonition">
<p class="admonition-title">Task</p>
<p>Create a copy of your <em><strong>Lab 6 - 3D Worlds</strong></em> folder, rename it <em><strong>Lab 7 - Moving the Camera</strong></em>, rename the file <em><strong>3d_worlds.js</strong></em> to <em><strong>moving_the_camera.js</strong></em> and change <em><strong>index.html</strong></em> so that the page title is “Lab 7 - Moving the Camera” and it embeds the <em><strong>moving_the_camera.js</strong></em> file.</p>
</div>
<p>Load <em><strong>index.html</strong></em> in a live server to check everything is working ok.</p>
<figure class="align-default" id="moving-the-camera-figure">
<a class="reference internal image-reference" href="../_images/07_moving_the_camera.png"><img alt="../_images/07_moving_the_camera.png" src="../_images/07_moving_the_camera.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 57 </span><span class="caption-text">The cubes from <a class="reference internal" href="06_3D_worlds.html#d-worlds-section"><span class="std std-ref">Lab 6: 3D Worlds</span></a>.</span><a class="headerlink" href="#moving-the-camera-figure" title="Link to this image">#</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<section id="getting-keyboard-and-mouse-input">
<h2>Getting keyboard and mouse input<a class="headerlink" href="#getting-keyboard-and-mouse-input" title="Link to this heading">#</a></h2>
<p>We need a way to get keyboard and mouse input from the user and use it to move the camera. To do this we are going create a class to handle all inputs from the keyboard and mouse.</p>
<div class="tip admonition">
<p class="admonition-title">Task</p>
<p>Add the following class to the <em><strong>webGLUtils.js</strong></em> file</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">Input</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">};</span>

<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keyup&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">            </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">requestPointerLock</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mousemove&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">pointerLockElement</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">canvas</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelta</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">movementX</span><span class="p">;</span>
<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelta</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">movementY</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">isDown</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="p">[</span><span class="nx">key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">consumeMouseDelta</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelta</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelta</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>

<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelta</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelta</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">dx</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the <em><strong>moving_the_camera.js</strong></em> file, add the following after we have created the camera object</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Keyboard and mouse inputs</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Input</span><span class="p">(</span><span class="nx">canvas</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Here we create an Input class that contains the following properties and methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keys</span></code> – a JavaScript object that stores a boolean value for each key that is pressed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mouseDelta</span></code> – a JavaScript object that stores the distance that the mouse pointer has moved since the last frame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">addEventListener()</span></code> – a method listens to events happening in the browser window</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isDown()</span></code> – a method that provides an easy way to check whether are particular key is being pressed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consumeMouseDelta()</span></code> – a method that returns the values stored in <code class="docutils literal notranslate"><span class="pre">mouseDelta</span></code> and then resets it to zero</p></li>
</ul>
<p>The event listeners are used to update the <code class="docutils literal notranslate"><span class="pre">keys</span></code> and <code class="docutils literal notranslate"><span class="pre">mouseDelta</span></code> properties. For example, if we press the <kbd>W</kbd> key down when the browser window is active then <code class="docutils literal notranslate"><span class="pre">&quot;w&quot;</span></code> will be added to the <code class="docutils literal notranslate"><span class="pre">keys</span></code> object and assigned true value. When we release the <kbd>W</kbd> key the value will be changed to false.</p>
</section>
<hr class="docutils" />
<section id="using-keyboard-input-to-move-the-camera">
<h2>Using keyboard input to move the camera<a class="headerlink" href="#using-keyboard-input-to-move-the-camera" title="Link to this heading">#</a></h2>
<p>Now that we have a way of capturing keyboard and mouse inputs, we are going to use keyboard input to change the coordinates of the <span class="math notranslate nohighlight">\(\vec{eye}\)</span> vector, i.e., the camera position. Recall the view matrix from <a class="reference internal" href="06_3D_worlds.html#d-worlds-section"><span class="std std-ref">Lab 6: 3D Worlds</span></a> where we introduced the camera vectors seen in <a class="reference internal" href="#camera-vectors-figure-2"><span class="std std-numref">Fig. 58</span></a>.</p>
<figure class="align-default" id="camera-vectors-figure-2">
<a class="reference internal image-reference" href="../_images/06_view_space_alignment.svg"><img alt="../_images/06_view_space_alignment.svg" src="../_images/06_view_space_alignment.svg" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 58 </span><span class="caption-text">Camera vectors</span><a class="headerlink" href="#camera-vectors-figure-2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Since these three vectors point to the right, up and to the front of the camera we can use these to move the camera in those directions. For example, to move the camera forwards and backwards we simply add and subtract the front vector to the <span class="math notranslate nohighlight">\(\vec{eye}\)</span> vector (<a class="reference internal" href="#camera-movement-figure"><span class="std std-numref">Fig. 59</span></a>).</p>
<figure class="align-default" id="camera-movement-figure">
<a class="reference internal image-reference" href="../_images/07_camera_movement.svg"><img alt="../_images/07_camera_movement.svg" src="../_images/07_camera_movement.svg" style="width: 500px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 59 </span><span class="caption-text">Moving the camera forwards and backwards.</span><a class="headerlink" href="#camera-movement-figure" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="tip admonition">
<p class="admonition-title">Task</p>
<p>In the <em><strong>camera.js</strong></em> file, change the Camera class method <code class="docutils literal notranslate"><span class="pre">update()</span></code> so that is looks like the following</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">update</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>

<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalize</span><span class="p">(</span><span class="nx">cross</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">front</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">worldUp</span><span class="p">));</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">up</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nx">normalize</span><span class="p">(</span><span class="nx">cross</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">front</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Camera movement</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">isDown</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">addVector</span><span class="p">(</span><span class="nx">vel</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">front</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">isDown</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subtractVector</span><span class="p">(</span><span class="nx">vel</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">front</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">isDown</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subtractVector</span><span class="p">(</span><span class="nx">vel</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">right</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">isDown</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">addVector</span><span class="p">(</span><span class="nx">vel</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">right</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">length</span><span class="p">(</span><span class="nx">vel</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalize</span><span class="p">(</span><span class="nx">vel</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">eye</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">addVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">eye</span><span class="p">,</span><span class="w"> </span><span class="nx">vel</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the *<strong>moving_the_camera.js</strong>, delete the code that sets the <span class="math notranslate nohighlight">\(\vec{eye}\)</span> and <span class="math notranslate nohighlight">\(\vec{front}\)</span> camera vectors and change the method call to <code class="docutils literal notranslate"><span class="pre">camera.upate()</span></code> so that it takes the <code class="docutils literal notranslate"><span class="pre">input</span></code> object.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">camera</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Here we have made changes the <code class="docutils literal notranslate"><span class="pre">update()</span></code> camera class method to create a velocity vector and initialise it to all zeros. We then check whether any of the <kbd>W</kbd>, <kbd>S</kbd>, <kbd>A</kbd> and <kbd>D</kbd> keys are depressed, and if so we add the <span class="math notranslate nohighlight">\(\vec{front}\)</span> or <span class="math notranslate nohighlight">\(\vec{right}\)</span> vectors to the velocity vector. If the velocity vector is non-zero, so that a key is being pressed, we normalize it and add it to the <span class="math notranslate nohighlight">\(\vec{eye}\)</span> vector.</p>
<p>Now our WebGL application will listen to any keyboard input and move the camera using the WSAD keys. Refresh your browser and have a play with moving the camera around.</p>
<center>
<video autoplay controls muted="true" loop="true" width="500">
    <source src="../_static/videos/07_keyboard_1.mp4" type="video/mp4">
</video>
</center>
</section>
<hr class="docutils" />
<section id="controlling-the-speed-of-the-camera">
<h2>Controlling the speed of the camera<a class="headerlink" href="#controlling-the-speed-of-the-camera" title="Link to this heading">#</a></h2>
<p>Playing around with the camera movement you will also notice that the controls are quite sensitive and not very satisfying to use. To fix this we can control the speed at which the camera moves in the world space. Speed is distance divided by time so to ensure that the camera moves at a chosen speed we need to calculate the time that has elapsed since the previous frame was rendered.</p>
<p>We saw when we applied animations to the rectangle in the lab <a class="reference internal" href="05_Transformations.html#animating-objects-section"><span class="std std-ref">Lab 6: Transformations</span></a> that the <code class="docutils literal notranslate"><span class="pre">requestAnimationFrame()</span></code> function provides the time that has elapsed since the WebGL application was started, so we can use this to measure the time that has elapsed since the previous frame was rendered and use this in our movement calculations.</p>
<div class="tip admonition">
<p class="admonition-title">Task</p>
<p>Before the <code class="docutils literal notranslate"><span class="pre">render()</span></code> function add the following line of code</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Timer</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">lastTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Then edit the commands to update the camera vectors, so it looks like the following.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Update camera</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lastTime</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.001</span><span class="p">;</span>
<span class="nx">lastTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">;</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="nx">dt</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Here we have created the variable <code class="docutils literal notranslate"><span class="pre">lastFrame</span></code> which is used to store the time (in milliseconds) that has elapsed when the previous frame was rendered. We use this and the current time to calculate the change in time between the two frames <code class="docutils literal notranslate"><span class="pre">dt</span></code> in second which we have added as an input parameter to the <code class="docutils literal notranslate"><span class="pre">update()</span></code> Camera class method, so we now need to update that.</p>
<div class="tip admonition">
<p class="admonition-title">Task</p>
<p>First add the following to the Camera class constructor.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Movement settings</span>
<span class="k">this</span><span class="p">.</span><span class="nx">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
</pre></div>
</div>
<p>Then change the <code class="docutils literal notranslate"><span class="pre">update()</span></code> method declaration so that it takes in the <code class="docutils literal notranslate"><span class="pre">dt</span></code> input.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">update</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="nx">dt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
<p>Finally, change the calculation of the new <span class="math notranslate nohighlight">\(\vec{eye}\)</span> vector to the following.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">eye</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">addVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">eye</span><span class="p">,</span><span class="w"> </span><span class="nx">scaleVector</span><span class="p">(</span><span class="nx">vel</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">speed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dt</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>So here we have set the speed of our camera to 5 units per second and have scaled the velocity vector by this speed. The speed you choose is arbitrary, and we can change this to suit our needs, e.g., simulating a character sprinting. Refresh your browser and have a play with the controls, and you should have a much more satisfying result.</p>
<center>
<video autoplay controls muted="true" loop="true" width="500">
    <source src="../_static/videos/07_keyboard_2.mp4" type="video/mp4">
</video>
</center>
</section>
<hr class="docutils" />
<section id="using-the-mouse-to-point-the-camera">
<h2>Using the mouse to point the camera<a class="headerlink" href="#using-the-mouse-to-point-the-camera" title="Link to this heading">#</a></h2>
<p>We can now move the camera position using keyboard inputs, but we cannot yet point the camera in a different direction. This is usually done using mouse inputs but can also be done using keyboard or game controllers.</p>
<section id="yaw-pitch-and-roll">
<h3>Yaw, pitch and roll<a class="headerlink" href="#yaw-pitch-and-roll" title="Link to this heading">#</a></h3>
<p>The direction which the camera is pointing is governed by three angles called <span class="math notranslate nohighlight">\(yaw\)</span>, <span class="math notranslate nohighlight">\(pitch\)</span> and <span class="math notranslate nohighlight">\(roll\)</span> which are collectively known as <a href="https://en.wikipedia.org/wiki/Euler_angles" target="_blank">Euler angles</a>. The name of these come from the aviation industry where they are related to the direction that an aircraft is facing. A plane on the ground first needs to taxi to the end of a runway which is does by steering left and right in the horizontal direction by changing its <span class="math notranslate nohighlight">\(yaw\)</span> angle. Then on take off it can point its nose upwards in the vertical direction by changing its <span class="math notranslate nohighlight">\(pitch\)</span> angle. Once airborne the plane can move its wingtips up and down thus changing its <span class="math notranslate nohighlight">\(roll\)</span> angle. Our camera is analogous to the plane (<a class="reference internal" href="#yaw-pitch-roll-figure"><span class="std std-numref">Fig. 60</span></a>).</p>
<figure class="align-default" id="yaw-pitch-roll-figure">
<a class="reference internal image-reference" href="../_images/07_yaw_pitch_roll.svg"><img alt="../_images/07_yaw_pitch_roll.svg" src="../_images/07_yaw_pitch_roll.svg" style="width: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 60 </span><span class="caption-text">Yaw, pitch and roll</span><a class="headerlink" href="#yaw-pitch-roll-figure" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>To point our camera we only need the <span class="math notranslate nohighlight">\(yaw\)</span> and <span class="math notranslate nohighlight">\(pitch\)</span> angles which we are going to change using mouse inputs such that when the mouse is moved left and right the <span class="math notranslate nohighlight">\(yaw\)</span> angle changes and when the mouse is moved up and down the <span class="math notranslate nohighlight">\(pitch\)</span> angle changes. Our <code class="docutils literal notranslate"><span class="pre">getViewMatrix()</span></code> method uses the front vector to calculate the view matrix, so we need some way of calculating the front vector from the <span class="math notranslate nohighlight">\(yaw\)</span> and <span class="math notranslate nohighlight">\(pitch\)</span> angles.</p>
<figure class="align-default" id="yaw-figure">
<a class="reference internal image-reference" href="../_images/07_yaw.svg"><img alt="../_images/07_yaw.svg" src="../_images/07_yaw.svg" style="width: 350px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 61 </span><span class="caption-text">Looking down the <span class="math notranslate nohighlight">\(y\)</span>-axis.</span><a class="headerlink" href="#yaw-figure" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Consider (<a class="reference internal" href="#yaw-figure"><span class="std std-numref">Fig. 61</span></a>) that shows the front vector which is at an angle <span class="math notranslate nohighlight">\(yaw\)</span> from the positive <span class="math notranslate nohighlight">\(z\)</span>-axis. The <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> components of the rotated vector are the adjacent and opposite sides of the right-angled triangle. Remembering that <span class="math notranslate nohighlight">\(\cos(\theta) = adjacent/hypotenuse\)</span> and <span class="math notranslate nohighlight">\(\sin(\theta) = opposite/hypotenuse\)</span>, if front is a unit vector then <span class="math notranslate nohighlight">\(hypotenuse=1\)</span> and <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> components of the vector are</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \vec{front}_x &amp;= \sin(yaw), \\
    \vec{front}_z &amp;= \cos(yaw).
\end{align*} \end{split}\]</div>
<figure class="align-default" id="pitch-figure">
<a class="reference internal image-reference" href="../_images/07_pitch.svg"><img alt="../_images/07_pitch.svg" src="../_images/07_pitch.svg" style="width: 350px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 62 </span><span class="caption-text">Looking down the <span class="math notranslate nohighlight">\(x\)</span>-axis.</span><a class="headerlink" href="#pitch-figure" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>We now do the same for the <span class="math notranslate nohighlight">\(pitch\)</span> angle. The <span class="math notranslate nohighlight">\(z\)</span> (and <span class="math notranslate nohighlight">\(x\)</span>) component of the vector is the adjacent side and the <span class="math notranslate nohighlight">\(y\)</span> component is the opposite side (<a class="reference internal" href="#pitch-figure"><span class="std std-numref">Fig. 62</span></a>), i.e.,</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \vec{front}_x &amp;= \cos(pitch), \\
    \vec{front}_y &amp;= \sin(pitch), \\
    \vec{front}_z &amp;= \cos(pitch).
\end{align*} \end{split}\]</div>
<p>Combining this with the <span class="math notranslate nohighlight">\(yaw\)</span> rotation gives</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
    \vec{front}_x &amp;= \cos(pitch) \sin(yaw), \\
    \vec{front}_y &amp;= \sin(pitch), \\
    \vec{front}_z &amp;= \cos(pitch) \cos(yaw) .
\end{align*} \end{split}\]</div>
<p>This is the conversion between the <span class="math notranslate nohighlight">\(yaw\)</span> and <span class="math notranslate nohighlight">\(pitch\)</span> Euler angles and unit vector. However, this assumes alignment with the positive <span class="math notranslate nohighlight">\(z\)</span>-axis and in WebGL we look down the <span class="math notranslate nohighlight">\(z\)</span>-axis so we need to negate <span class="math notranslate nohighlight">\(\vec{front}_z\)</span>. Therefore</p>
<div class="math notranslate nohighlight" id="equation-eq-euler-to-vector">
<span class="eqno">(21)<a class="headerlink" href="#equation-eq-euler-to-vector" title="Link to this equation">#</a></span>\[ \vec{front} = (\cos(pitch) \sin(yaw), \sin(pitch), -\cos(pitch) \cos(yaw)).\]</div>
<p>So now we can calculate the front vector from the <span class="math notranslate nohighlight">\(yaw\)</span> and <span class="math notranslate nohighlight">\(pitch\)</span> Euler angles. To apply this to our Camera class we need to add attributes for the <span class="math notranslate nohighlight">\(yaw\)</span> and <span class="math notranslate nohighlight">\(pitch\)</span> Euler angles and calculate the <span class="math notranslate nohighlight">\(\vec{front}\)</span> vector.</p>
<div class="tip admonition">
<p class="admonition-title">Task</p>
<p>Add the following to the movement settings in the Camera class constructor</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">turnSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.005</span><span class="p">;</span><span class="w">  </span>
<span class="k">this</span><span class="p">.</span><span class="nx">yaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">pitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</pre></div>
</div>
<p>And add the following before the <span class="math notranslate nohighlight">\(\vec{right}\)</span> and <span class="math notranslate nohighlight">\(\vec{front}\)</span> camera vectors are calculated in the <code class="docutils literal notranslate"><span class="pre">update()</span></code> method</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">dx</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">consumeMouseDelta</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">yaw</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">turnSpeed</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">pitch</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">turnSpeed</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">yaw</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pitch</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">sy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">yaw</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pitch</span><span class="p">);</span>

<span class="k">this</span><span class="p">.</span><span class="nx">front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalize</span><span class="p">([</span><span class="nx">cp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">sy</span><span class="p">,</span><span class="w"> </span><span class="nx">sp</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nx">cp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cy</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<p>Here we have added Camera class properties for controlling the turn speed of the camera and storing the <span class="math notranslate nohighlight">\(yaw\)</span> and <span class="math notranslate nohighlight">\(pitch\)</span> angles. Then we have modified the <code class="docutils literal notranslate"><span class="pre">update()</span></code> Camera class method to get the mouse movement values from the input, use these to update the <span class="math notranslate nohighlight">\(yaw\)</span> and <span class="math notranslate nohighlight">\(pitch\)</span> angles and calculate the <span class="math notranslate nohighlight">\(\vec{front}\)</span> vector using equation <a class="reference internal" href="#equation-eq-euler-to-vector">(21)</a>. Note that we have subtract <code class="docutils literal notranslate"><span class="pre">dy</span> <span class="pre">*</span> <span class="pre">turnSpeed</span></code> from the <span class="math notranslate nohighlight">\(pitch\)</span> angle because the mouse movement is measured from the top of the canvas.</p>
<p>Running the program and we can now move around our world space and point the camera using the mouse.</p>
<center>
<video autoplay controls muted="true" loop="true" width="500">
    <source src="../_static/videos/07_mouse_1.mp4" type="video/mp4">
</video>
</center>
</section>
<section id="limiting-the-pitch-angle">
<h3>Limiting the pitch angle<a class="headerlink" href="#limiting-the-pitch-angle" title="Link to this heading">#</a></h3>
<p>A problem that we have with our camera is that when we try to look straight up or straight down the orientation of the world flips. Position the camera above (or below) the crates and move the camera past <span class="math notranslate nohighlight">\(90^\circ\)</span> and <span class="math notranslate nohighlight">\(-90^\circ\)</span>.</p>
<center>
<video autoplay controls muted="true" loop="true" width="500">
    <source src="../_static/videos/07_mouse_2.mp4" type="video/mp4">
</video>
</center>
<p>This is due to the calculation of <span class="math notranslate nohighlight">\(\cos(pitch)\)</span> and <span class="math notranslate nohighlight">\(\sin(pitch)\)</span> in equation <a class="reference internal" href="#equation-eq-euler-to-vector">(21)</a>. To prevent this we can limit the <span class="math notranslate nohighlight">\(pitch\)</span> angle in the <code class="docutils literal notranslate"><span class="pre">mouseMove()</span></code> Camera class method.</p>
<div class="tip admonition">
<p class="admonition-title">Task</p>
<p>Add the following code to the <code class="docutils literal notranslate"><span class="pre">update()</span></code> Camera class method after the <span class="math notranslate nohighlight">\(pitch\)</span> angle has been updated.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Limit the pitch angle to -89 degrees &lt; pitch &lt; 89 degrees</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">pitchLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">89</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">pitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="o">-</span><span class="nx">pitchLimit</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">pitchLimit</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">pitch</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>Refresh your web browser and try to look straight up or down towards the crates and you should find that the camera is prevented from moving past <span class="math notranslate nohighlight">\(\pm 90^\circ\)</span>.</p>
</section>
</section>
<hr class="docutils" />
<section id="back-face-culling">
<h2>Back face culling<a class="headerlink" href="#back-face-culling" title="Link to this heading">#</a></h2>
<p>Whilst moving your camera around your 3D world you may notice that we can move through objects and view them from the inside. All surfaces of the cubes are rendered, including those not visible from the camera because they are on the far side of the cubes. This is a waste of resources as WebGL is calculating the vertex and fragment shaders for objects that won’t be shown in the frame. To overcome this we can cull (omit) any surface of an object that is <strong>back facing</strong> the camera in a method called <strong>back face culling</strong>.</p>
<p id="normal-vector-section">A <strong>normal vector</strong> (often just referred to as a <strong>normal</strong>) is a vector denoted by <span class="math notranslate nohighlight">\(\vec{n}\)</span> that is perpendicular to a surface at a given point (<a class="reference internal" href="#normal-vector-figure"><span class="std std-numref">Fig. 63</span></a>).</p>
<figure class="align-default" id="normal-vector-figure">
<a class="reference internal image-reference" href="../_images/07_normal_vector.svg"><img alt="../_images/07_normal_vector.svg" src="../_images/07_normal_vector.svg" style="width: 350px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 63 </span><span class="caption-text">The surface normal vector.</span><a class="headerlink" href="#normal-vector-figure" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Since in computer graphics are surfaces are triangles, we can easily calculate a normal vector using a <a class="reference internal" href="04_Vectors_and_matrices.html#cross-product-section"><span class="std std-ref">cross product</span></a>. If a triangle has vertices <span class="math notranslate nohighlight">\(\vec{v}_0\)</span>, <span class="math notranslate nohighlight">\(\vec{v}_1\)</span> and <span class="math notranslate nohighlight">\(\vec{v}_2\)</span> then the normal vector can be calculated using</p>
<div class="math notranslate nohighlight">
\[ \vec{n} = (\vec{v}_1 - \vec{v}_0) \times (\vec{v}_2 - \vec{v}_1). \]</div>
<p>A surface is said to be back facing it its normal vector is pointing away from the camera position. If we only render the front facing surfaces then, assuming the surfaces are opaque, we should not notice any difference, and we have halved the number of surfaces the shader has to deal with (<a class="reference internal" href="#backface-culling-figure"><span class="std std-numref">Fig. 64</span></a>).</p>
<figure class="align-default" id="backface-culling-figure">
<a class="reference internal image-reference" href="../_images/07_backface_culling.svg"><img alt="../_images/07_backface_culling.svg" src="../_images/07_backface_culling.svg" style="width: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 64 </span><span class="caption-text">Back face culling removes surfaces with vectors pointing away from the camera.</span><a class="headerlink" href="#backface-culling-figure" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>But how do we know if a surface is back facing? Consider <a class="reference internal" href="#back-facing-figure"><span class="std std-numref">Fig. 65</span></a> which shows a back facing surface.</p>
<figure class="align-default" id="back-facing-figure">
<a class="reference internal image-reference" href="../_images/07_back_facing_polygon.svg"><img alt="../_images/07_back_facing_polygon.svg" src="../_images/07_back_facing_polygon.svg" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 65 </span><span class="caption-text">A back facing surface.</span><a class="headerlink" href="#back-facing-figure" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Here <span class="math notranslate nohighlight">\(\vec{v}\)</span> is a vector pointing from the camera to a point on the surface. Recall that the <a class="reference internal" href="04_Vectors_and_matrices.html#dot-product-section"><span class="std std-ref">dot product</span></a> is related to the angle between two vectors, i.e.,</p>
<div class="math notranslate nohighlight">
\[ \vec{n} \cdot \vec{v} = \| \vec{n} \| \| \vec{v} \| \cos(\theta). \]</div>
<p>If we have a back facing surface then <span class="math notranslate nohighlight">\(\theta\)</span> is less than 90<span class="math notranslate nohighlight">\(^\circ\)</span> and <span class="math notranslate nohighlight">\(\cos(\theta)\)</span> is a positive number so</p>
<div class="math notranslate nohighlight">
\[\begin{align*}
  \vec{n} \cdot \vec{v} &gt; 0.
\end{align*}\]</div>
<p>So to apply back face culling the vertex shader just has to calculate the dot product between the <span class="math notranslate nohighlight">\(\vec{n}\)</span> and <span class="math notranslate nohighlight">\(\vec{v}\)</span> vectors and if it is a positive number it ignores the surface from then on.</p>
<div class="tip admonition">
<p class="admonition-title">Task</p>
<p>Add the following line of code to the <code class="docutils literal notranslate"><span class="pre">initWebGL()</span></code> function in the <em><strong>webGLUtils.js</strong></em> file.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">CULL_FACE</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Refresh your web browser and use the keyboard and mouse to put the camera inside a cube. You will now see that the back faces haven’t been rendered.</p>
<center>
<video autoplay controls muted="true" loop="true" width="60%">
    <source src="../_static/videos/07_mouse_3.mp4" type="video/mp4">
</video>
</center>
</section>
<hr class="docutils" />
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p>Make it so that the camera position always has a <span class="math notranslate nohighlight">\(y\)</span> coordinate of 0, i.e., like a first-person shooter game where the player cannot fly around the world.</p></li>
<li><p>Add the ability for the user to perform a jump by pressing the space bar. Hints:</p>
<ul class="simple">
<li><p>To record when the space bar is pressed you can use <code class="docutils literal notranslate"><span class="pre">input.isDown(&quot;</span> <span class="pre">&quot;)</span></code>.</p></li>
<li><p>You will need a way of recording when the space bar was first pressed and when the jump has been completed.</p></li>
<li><p>For a jump based on physics the height of the camera can be calculated for each frame using</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\vec{eye}_y = \vec{eye}_y + jump\, velocity \times \Delta t\]</div>
<ul class="simple">
<li><p>The <span class="math notranslate nohighlight">\(jump \, velocity\)</span> is initialised to some value (the larger the value the higher the jump), and is updated at each frame using</p></li>
</ul>
<div class="math notranslate nohighlight">
\[jump \, velocity = jump \, velocity - 9.81 \times \Delta t\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(9.81ms^{-2}\)</span> is the acceleration due to gravity on Earth.</p></li>
</ul>
</li>
<li><p>Add collision detection so that the camera cannot pass through the cube objects. A simple (but crude) way of doing this is</p>
<ul class="simple">
<li><p>Loop through all the cubes</p></li>
<li><p>Calculate the distance between the <span class="math notranslate nohighlight">\(\vec{eye}\)</span> vector and the centre of the current cube</p></li>
<li><p>If this distance is less than 1, move the <span class="math notranslate nohighlight">\(\vec{eye}\)</span> away from the centre of the current cube so that the distance is now 1</p></li>
</ul>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="video-walkthrough">
<h2>Video walkthrough<a class="headerlink" href="#video-walkthrough" title="Link to this heading">#</a></h2>
<p>The video below walks you through these lab materials.</p>
<iframe 
    width="560"
    height="315"
    src="https://www.youtube.com/embed/uIRpZXMt7eA?si=m7JHMkgnuKHf5lXY"
    title="YouTube video player"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen
></iframe>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./_pages"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="06_3D_worlds.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 6: 3D Worlds</p>
      </div>
    </a>
    <a class="right-next"
       href="08_Lighting.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 8: Lighting</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-keyboard-and-mouse-input">Getting keyboard and mouse input</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-keyboard-input-to-move-the-camera">Using keyboard input to move the camera</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-the-speed-of-the-camera">Controlling the speed of the camera</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-mouse-to-point-the-camera">Using the mouse to point the camera</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#yaw-pitch-and-roll">Yaw, pitch and roll</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#limiting-the-pitch-angle">Limiting the pitch angle</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#back-face-culling">Back face culling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#video-walkthrough">Video walkthrough</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Jon Shiach
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>